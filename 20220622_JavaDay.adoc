= 2022/06/22 - JavaDay au Paris JUG: Le futur de Java en 2022
Thomas SCHWENDER <icon:github[] https://github.com/Ardemius/[GitHub] / icon:twitter[role="aqua"] https://twitter.com/thomasschwender[@thomasschwender]>
// Handling GitHub admonition blocks icons
ifndef::env-github[:icons: font]
ifdef::env-github[]
:status:
:outfilesuffix: .adoc
:caution-caption: :fire:
:important-caption: :exclamation:
:note-caption: :paperclip:
:tip-caption: :bulb:
:warning-caption: :warning:
endif::[]
:imagesdir: ./images
:source-highlighter: highlightjs
:highlightjs-languages: asciidoc
// We must enable experimental attribute to display Keyboard, button, and menu macros
:experimental:
// Next 2 ones are to handle line breaks in some particular elements (list, footnotes, etc.)
:lb: pass:[<br> +]
:sb: pass:[<br>]
// check https://github.com/Ardemius/personal-wiki/wiki/AsciiDoctor-tips for tips on table of content in GitHub
:toc: macro
:toclevels: 4
// To number the sections of the table of contents
//:sectnums:
// Add an anchor with hyperlink before the section title
:sectanchors:
// To turn off figure caption labels and numbers
:figure-caption!:
// Same for examples
//:example-caption!:
// To turn off ALL captions
// :caption:

toc::[]

* JavaDay organis√© par le Paris JUG, au centre des congr√®s du Jardin d'Acclimatation, le 22/06/2022
* Description de l'√©v√®nement : https://javaday.parisjug.org/

== 09h15	: Accueil des participants

image:20220622_JavaDay_00.jpg[]

== 10h00 : Java en 2022 : profiter de Java 17

Talk donn√© par Jean-Michel Doudoux

.Abstract
----
Beaucoup d‚Äôapplications utilisent encore Java 8 mais Java a beaucoup √©volu√© depuis notamment avec la diffusion de deux versions LTS.

L‚Äôobjectif de cette pr√©sentation est de revenir sur certaines de ces nombreuses √©volutions de Java, notamment r√©centes afin d‚Äôen profiter dans nos applications. Au-del√† des √©volutions syntaxiques et dans les API, ce sera aussi l‚Äôoccasion de justifier la migration vers des versions plus r√©centes de Java.
----

=== Le pass√©

On commence par des rappels sur les grandes fonctionnalit√©s des pr√©c√©dentes versions de Java depuis Java 8

    * Java 8
    * Java 9
        ** JShell
        ** VarHandle
        ** *Et les fameux modules* : une fonctionnalit√© impactante et tr√®s controvers√©ee
            *** et dont la mise en oeuvre implique des contraintes (visibilit√©, accessibilit√©, organisation du code, ...)
        ** cr√©ation d'un JRE personnalit√© avec JLink
        ** `var` pour faciliter la d√©finition de variables
    * Java 10
        ** bien meilleur support des containers
    * Java 11
        ** version LTS
    * Java 14
        ** refonte des switch expression
            *** le switch devient une vraie expression. +
            On peut donc faire `String libelle = switch...` +
            image:20220622_JavaDay_01.jpg[]
    * Java 15
        ** blocs de texte
            *** exprimer une cha√Æne de caract√®res litt√©rale multiligne
        ** Helpful NullPointerException
    * Java 16
        ** pattern matching pour instanceof
        ** nouveau type de classe, les *records*
            *** son but est d'encapsuler des variables de fa√ßon immuable
    * Java 17
        ** les classes scell√©es (`sealed` classes) +
        image:20220622_JavaDay_02.jpg[]
        ** nouvelle version LTS
        ** diffus√©e en septembre 2021
        ** changement de licence d'Oracle (qui remet un peu de gratuit√© dedans)
    * Java 18
        ** diffus√©e en mars 2022
        ** UTF-8 par d√©faut (enfin !), sauf pour la sortie console
        ** le m√©canisme finalize est d√©pr√©ci√©

=== Le pr√©sent

Comment "vendre" √† la PROD (les OPS) la migration √† une version r√©cente de Java ? +
-> les bons arguments : *performance* et *s√©curit√©*

.Performance
image:20220622_JavaDay_03.jpg[]

.S√©curit√©
image:20220622_JavaDay_04.jpg[]

Comment "vendre" au management cette fois ? +
-> Les *co√ªts*, et d'autres arguments (dont le RGPD)

.Les autres arguments
image:20220622_JavaDay_05.jpg[]

*R√®gles g√©n√©rales de migration > 8*

    * mettre √† jour les outils
    * mettre √† jour les d√©pendances
    * utiliser jdeps
    * mythe urbain : aucune obligation de modulariser l'application

-> A partir de Java 11 toute version de Java retire des choses

    * `jdeprscan` pour obtenir les API d√©pr√©ci√©es du JDK
    * Jetez un oeil √† l'*almanac Java* pour vous aider

.migration de Java 8 vers Java 11
image:20220622_JavaDay_06.jpg[]

migration de Java 11 vers Java 17 : 

    * Il est important d'avoir un coverage √† 100% du code. +
    Pourquoi ? A cause de la nouvelle encapsulation forte des API internes du JDK +
    image:20220622_JavaDay_07.jpg[]

migration de Java 8 √† 17

=== Le futur

.Les projets futurs de Java
image:20220622_JavaDay_08.jpg[]

* pattern matching pour les switch (en preview d√®s Java 17)

.Et le futur un tout petit peu plus √©loign√©
image:20220622_JavaDay_09.jpg[]

-> Conclusion : Dans tous les cas, pour profiter de ces nouvelles fonctionnalit√©s, il *FAUT* migrer !

-> Ce talk est tr√®s proche de celui donn√© par Jean-Michel au dernier Devoxx France 2022 ("10 ans de Devoxx France et de Java"), et dont les slides sont disponibles ici : +
https://fr.slideshare.net/jmdoudoux/devoxx-2022-10-ans-de-devoxx-fr-et-de-javapdf

[NOTE]
====
Pour f√™ter les 4000 pages de "D√©veloppons en Java", le JavaDay offre 4 millefeuilles √† JM üòÅ 

image:20220622_JavaDay_10.jpg[]
====

== 10h50 : Rem√®des aux oomkill, warm-ups, et lenteurs pour des conteneurs JVM

Talk donn√© par Jean-Philippe Bempel et Brice Dutheil

-> Ce talk a √©t√© donn√© au dernier Devoxx France 2022 +
Il a trait √† tous les probl√®mes (oomkill) que l'on peut rencontrer quand l'on fait tourner Java dans un container (Kubernetes).

Mes notes de l'√©poque sont disponibles ici : +
https://github.com/Ardemius/meetups-talks-conferences-notes/tree/master/202204-devoxx-france#09h30-12h30-242ab-rem%C3%A8des-aux-oomkill-warm-ups-et-lenteurs-pour-des-conteneurs-jvm

=== Partie m√©moire et oomkill

.Rappel sur le RSS, le Resident Set Size
[NOTE]
====
La *Resident Set Size* (*RSS*, "taille du jeu r√©sident") est la quantit√© de m√©moire occup√©e par un processus contenue dans la RAM. +
RSS permet d‚Äôobtenir la taille r√©elle du conteneur Kubernetes.
====

.De quoi est compos√©e la m√©moire d'une JVM ?
image:20220622_JavaDay_11.jpg[]

* Pour le *monitoring*, il existe une multitudes de *MBeans* (accessible via *JMX*) +
Gr√¢ce √† cela on aura des infos sur quelques zones m√©moires, mais PAS toutes

* Il va falloir utiliser des outils de diagnostic, comme le fantastique *jcmd* +
image:20220622_JavaDay_12.jpg[]

    ** `jcmd $(pidof java) VM.native_memory` +
    image:20220622_JavaDay_13.jpg[]

.Il est important de donner au container plus de RAM que la valeur max de la heap
image:20220622_JavaDay_14.jpg[]

=== Autres probl√®mes

* red√©marrage du container

* Le JIT et les *compilateurs C1 et C2* :
    ** The JDK implementation by Oracle is based on the open-source OpenJDK project, which includes the HotSpot virtual machine.
    ** It contains 2 conventional JIT-compilers: the client compiler, also called C1 and the server compiler, called opto or C2.

* Avec Kubernetes, plus qu'une notion de CPU, on a une notion de *shares* et *quotas* +
image:20220622_JavaDay_15.jpg[]
image:20220622_JavaDay_16.jpg[]

* *Tuning CPU* : toujours un trade-off entre startup time vs request time
    ** adjust CPU shares  CPU quotas
    ** adjust liveness timeout
    ** use readiness / startup probes

.En conclusion, que faire quant √† la m√©moire et au d√©marrage
image:20220622_JavaDay_17.jpg[]
image:20220622_JavaDay_18.jpg[]

* Le conseil final de JP : TOUJOURS setter la heap (TOUJOURS) 
* Et attention au *RAMPercentage* qui n'est PAS un silver bullet pour r√©soudre tous les probl√®mes (loin de l√†)

-> Un talk qui rentre vraiment dans le d√©tail du domaine de la performance. +
A utiliser si vous √™tes confront√©s aux probl√®mes d√©crits (ou pour culture g√©n√©rale et savoir que des solutions existent). Peut para√Ætre un rien "abrupte" de prime abord üòâ 

TIP: Je conseille de vous r√©f√©rer au talk donn√© √† Devoxx si vous voulez plus de d√©tails, car il s'agissait d'une universit√© de 3h üòâ 

== 11h40 : S√©curit√© en Java 17 : les nouveaut√©s pass√©es et √† venir

Talk donn√© par Charles Sabourdin

* Initialement la JVM servait √† faire tourner du code qu'on ne connaissait pas sur le navigateur
* DONC la JVM est arriv√© avec son propre syst√®me de s√©curisation pour l'isoler du syst√®me

.Java Security Model
image:20220622_JavaDay_19.jpg[]

* Autre info √† savoir : pour des *raisons l√©gales*, certaines *fonctionnalit√©s sont volontairement limit√©es*, car jug√©es "trop puissantes" dans d'autres pays (surtout dans le cas de la cryptographie)
    ** Un exemple dans un autre monde que Java, la PS2 ne pouvait pas s'exporter partout car jug√©e trop puissante. +
    Jetez un oeil √† la section 4.2.4 de cet article pour plus d'infos : https://e.20-bal.com/law/18082/index.html
    ** D'o√π l'usage d'un *Security Provider* dans Java : https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/security/Provider.html

* *C'est √† nous d'indiquer √† notre serveur quels types de cl√©s, quels types de traitement il peut accepter*. Cela afin que le client ne puisse pas forcer un certificat que l'on n'accepte pas.

* Avec le Java 17, le *Security Manager* est maintenant *d√©pr√©ci√©*.
    ** Et devrait donc √™tre supprim√© d'ici peu

== 12h30 : D√©jeuner et caf√©


== 14h00 : C√©dric Champeau : Micronaut AOT pour optimiser vos applications pour le JIT et GraalVM


== 14h50 : Herv√© Boutemy : De Maven 3 √† Maven 5


== 15h35 : Pause caf√©


== 16h00 : R√©mi Forax : Valhalla: Vers de nouveaux generics universels et specialisables


== 16h50 : Panel de discussions avec les speakers


== 17h30 : Fin de la journ√©e















